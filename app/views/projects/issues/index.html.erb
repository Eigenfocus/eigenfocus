<% set_page_title(:project_all_issues, project_name: current_project.name) %>

<%= start_pending_app_tour_tag("issues/index") %>

<%= turbo_frame_tag 'new_issue_form', src: (params[:open_form] ? new_project_issue_path(current_project) : nil) do %>
<% end %>

<%= render partial: 'projects/navigation_header', locals: {
  project: current_project
} %>

<div class="bg-base-100 px-8 min-h-screen">
  <%= turbo_frame_tag 'issues', class: "tour--issues-list", autoscroll: true, 'autoblock-scroll': 'start', data: { turbo_action: "advance" } do %>
    <%= render partial: 'filter', locals: { q: @q } %>

    <div class="mt-6 mb-4 flex justify-end gap-4 items-center flex-col lg:flex-row">
      <%= link_to "#{t('actions.create')} #{Issue.model_name.human.downcase}",
          new_project_issue_path(current_project),
          class: "btn btn-primary tour--create-issue",
          data: { turbo_frame: 'new_issue_form' } %>
    </div>


    <div class="overflow-x-auto rounded-box">
      <% if @issues.empty? %>
        <%= render EmptyListComponent.new(
          message: params[:q].present? ?
            t("zero_records_for_this_search", resource_name: Issue.model_name.human) :
            t("zero_records", resource_name: Issue.model_name.human))
        %>
      <% else %>
        <table class="table table-header">
          <thead class="">
            <tr>
              <th><%= sort_link(@q, :title, Issue.human_attribute_name(:title)) %></th>
              <th><%= Issue.human_attribute_name(:labels) %></th>
              <th><%= sort_link(@q, :groupings_title, Issue.human_attribute_name(:grouping)) %></th>
              <th><%= sort_link(@q, :due_date, Issue.human_attribute_name(:due_date)) %></th>
              <th class="text-center"><%= t(:actions, scope: :menu) %></th>
            </tr>
          </thead>
          <tbody class="" id="all-issues-list">
            <% @issues.each do |issue| %>
              <%= render partial: 'issue', locals: { issue: issue, project: current_project } %>
            <% end %>
          </tbody>
        </table>

        <%== pagy_summary(@pagy) %>
      <% end %>
    </div>
  <% end %>
</div>